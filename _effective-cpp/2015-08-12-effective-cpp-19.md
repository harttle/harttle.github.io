---
layout: blog
title: Item 19：把类的设计视作类型设计

tags: C++ 接口 类型转换 赋值运算符 构造函数 拷贝构造函数
excerpt: 在面向对象语言中，开发者的大部分时间都用在了增强你的类型系统。这意味着你不仅是类的设计者，更是类型设计者。重载函数和运算符、控制内存分配和释放、定义初始化和销毁操作……良好的类型有着自然的语法、直观的语义，以及高效的实现。你在定义类时需要像一个语言设计者一样地小心才行！
---

> Item 19: Teat class design as type design.

在面向对象语言中，开发者的大部分时间都用在了增强你的类型系统。这意味着你不仅是类的设计者，更是类型设计者。
重载函数和运算符、控制内存分配和释放、定义初始化和销毁操作……良好的类型有着自然的语法、直观的语义，以及高效的实现。
你在定义类时需要像一个语言设计者一样地小心才行！

**类的设计就是类型设计**，当你定义一个类之前，需要面对这些问题：

* 这个新的类型如何创建和销毁？`new`还是`new []`？
* 初始化和赋值之间又怎样的区别？它们确实是不同的函数调用，参见：[Item 4：确保变量的初始化][item4]
* 如果该类型的对象被传值而不是传引用，意味着怎样的语义？记住：传值时调用的是拷贝构造函数！
* 该类型合理的取值范围是？在你的成员函数、赋值和构造函数中需要做相应的范围检查！
* 你的新类型能融合到继承图中吗？如果你继承自已有的类，你的类将被它们限制（尤其是虚函数限定）；如果你希望其他类来继承该类型，那么你的方法是否需要声明为`virtual`？尤其是析构函数。
* 你的新类型允许怎样的类型转换？你可能需要将构造函数声明为`explicit`来避免隐式类型转换。参见：[Item 15：资源管理类需要提供对原始资源的访问][item15]
* 哪些运算符对你的新类型是有意义的？
* 那些编译器生成的默认方法需要被禁止？参见：[Item 6：禁用那些不需要的缺省方法][item6]
* 谁可以访问你的成员方法？私有、保护、共有成员限定符；友元类、友元函数。
* 你想提供哪些潜在的接口？它们往往关乎异常安全、效率、资源使用等，这些潜在的接口将会影响你的实现。
* 你的类型有多么通用？如果它是非常通用的类型，你可以考虑通过模板把它定义成一系列的类。
* 你真的需要这个新的类型吗？如果你为了扩展一个类而继承了它，那么定义一个非成员函数或者模板能否更好地解决问题？

[item4]: /2015/07/22/effective-cpp-4.html
[item15]: /2015/08/05/effective-cpp-15.html
[item6]: /2015/07/23/effective-cpp-6.html
