!function(){var e,t;function r(){var e=window.sessionStorage.getItem("pv");return e?JSON.parse(e):{}}e=r(),t=location.pathname,e[t]=(e[t]||0)+1,window.sessionStorage.setItem("pv",JSON.stringify(e)),fetch("/api/posts.json").then(function(e){return e.json()}).then(function(e){if("string"==typeof e&&(e=JSON.parse(e)),!(e.length<2)){var t,n=[],o=r();e.filter(function(e){return e.url===location.pathname?(t=e,!1):0!==e.tags.length}).forEach(function(e){if(t){var r,l,a;e.sim=o[e.url]?0:(r=e.tags,l=t.tags,a={},r.forEach(function(e){a[e]=!0}),l.filter(function(e){return a[e]}).length/Math.sqrt(r.length)/Math.sqrt(l.length));for(var i=0;i<n.length;i++){var s=n[i];if(s.sim<e.sim){n.splice(i,0,e),e=null;break}}for(e&&n.push(e);n.length>3;)n.pop()}}),console.log("similar posts:",n);var l=document.querySelector(".post-pager .previous"),a=document.querySelector(".post-pager .next"),i=l&&l.getAttribute("href"),s=a&&a.getAttribute("href");if(n.length&&i===n[0].url&&n.shift(),n.length&&s===n[0].url&&n.shift(),n.length){var u=n[0],c=document.querySelector(".post-pager .recommend");c.setAttribute("href",u.url),c.textContent="推荐阅读："+u.title,c.style.display="block"}else console.info("no similar posts found, recommendation disabled")}})}(),function(){var e=document.querySelector(".md"),t=window.asideTOC;!function(){var r=function(e){var t=document.createElement("ul");t.setAttribute("class","nav level-0 list-unstyled sidenav");var r=1;for(;!e.querySelector("h"+r)&&r<7;)r+=1;return 7===r?null:(Array.prototype.forEach.call(e.querySelectorAll("h1,h2,h3,h4,h5,h6"),function(e,n){var o="header-"+n;e.setAttribute("id",o);var l=parseInt(e.nodeName.substr(1))-r,a=document.createElement("li");a.innerHTML='<a href="#'+o+'">'+e.textContent+'</a><ul class="nav list-unstyled level-'+(l+1)+'"/>';var i=document.createElement("div");i.appendChild(t);var s=i.querySelectorAll("ul.level-"+l);s.length&&s[s.length-1].appendChild(a)}),t)}(e),n=document.querySelector("article");if(!r)return void n.classList.add("collapsed");t.appendChild(r);var o=406;window.addEventListener("scroll",function(){var e,r=window.pageYOffset<o?"affix-top":"affix";t.setAttribute("class",r),Array.prototype.forEach.call(t.querySelectorAll("a"),function(t){var r=t.getAttribute("href"),n=document.querySelector(r);window.pageYOffset>n.offsetTop-20&&(e=t),t.parentNode.removeAttribute("class")});for(;e;)e.parentNode.classList.add("active"),e=e.parentNode.parentNode.previousElementSibling})}()}();
