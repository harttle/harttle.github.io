!function(){var e,t;function u(){var e=window.sessionStorage.getItem("pv");return e?JSON.parse(e):{}}e=u(),t=location.pathname,e[t]=(e[t]||0)+1,window.sessionStorage.setItem("pv",JSON.stringify(e)),fetch("/api/posts.json").then(function(e){return e.json()}).then(function(e){if("string"==typeof e&&(e=JSON.parse(e)),!(e.length<2)){var a,i=[],s=u();e.filter(function(e){return e.url===location.pathname?(a=e,!1):0!==e.tags.length}).forEach(function(e){if(a){var t,r,n;e.sim=s[e.url]?0:(t=e.tags,r=a.tags,n={},t.forEach(function(e){n[e]=!0}),r.filter(function(e){return n[e]}).length/Math.sqrt(t.length)/Math.sqrt(r.length));for(var o=0;o<i.length;o++){var l=i[o];if(l.sim<e.sim){i.splice(o,0,e),e=null;break}}for(e&&i.push(e);3<i.length;)i.pop()}}),console.log("similar posts:",i);var t=document.querySelector(".post-pager .previous"),r=document.querySelector(".post-pager .next"),n=t&&t.getAttribute("href"),o=r&&r.getAttribute("href");if(i.length&&n===i[0].url&&i.shift(),i.length&&o===i[0].url&&i.shift(),i.length){var l=i[0],c=document.querySelector(".post-pager .recommend");c.setAttribute("href",l.url),c.textContent="推荐阅读："+l.title,c.style.display="block"}else console.info("no similar posts found, recommendation disabled")}})}(),function(){var r=document.querySelector(".md"),o=document.querySelector("aside .toc-slot");function n(){var n;for(Array.prototype.forEach.call(o.querySelectorAll("a"),function(e){var t=e.getAttribute("href"),r=document.querySelector(t);window.pageYOffset>r.offsetTop-20&&(n=e),e.parentNode.removeAttribute("class")});n;)n.parentNode.classList.add("active"),n=n.parentNode.parentNode.previousElementSibling}!function(){var e=function(e){var i=document.createElement("ul");i.setAttribute("class","level-0 list-unstyled");var s=1;for(;!e.querySelector("h"+s)&&s<7;)s+=1;return 7===s?null:(Array.prototype.forEach.call(e.querySelectorAll("h1,h2,h3,h4,h5,h6"),function(e,t){var r="header-"+t;e.setAttribute("id",r);var n=parseInt(e.nodeName.substr(1))-s,o=document.createElement("li");o.innerHTML='<a class="ellipsis" href="#'+r+'" title="'+e.textContent.replace(/"/g,'\\"')+'">'+e.textContent+'</a><ul class="list-unstyled level-'+(n+1)+'"/>';var l=document.createElement("div");l.appendChild(i);var a=l.querySelectorAll("ul.level-"+n);a.length&&a[a.length-1].appendChild(o)}),i)}(r),t=document.querySelector("article");if(!e)return t.classList.add("collapsed");o.appendChild(e),window.addEventListener("scroll",n)}()}();
